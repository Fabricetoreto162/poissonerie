{% extends 'Base/base.html' %}

{% block title %}Gestion des Boutiques - StockFlow{% endblock %}

{% block extra_css %}
<style>
    /* Variables spécifiques aux boutiques */
    :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --accent: #1abc9c;
        --success: #27ae60;
        --warning: #f39c12;
        --danger: #e74c3c;
        --light: #f8f9fa;
        --dark: #2c3e50;
        --gray: #95a5a6;
    }

    /* Header de la page */
    .page-header {
        background: linear-gradient(135deg, var(--primary), #34495e);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .page-header h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .page-header p {
        opacity: 0.9;
        font-size: 16px;
        margin-bottom: 20px;
    }

    /* Sélecteur de date */
    .date-selector-container {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 15px;
        border-radius: 8px;
        margin-top: 10px;
        width: fit-content;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .date-selector-label {
        font-size: 14px;
        font-weight: 500;
        margin-right: 10px;
        display: flex;
        align-items: center;
    }

    .date-selector {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 14px;
        color: var(--dark);
        transition: all 0.3s;
    }

    .date-selector:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .date-selector-container .btn {
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 13px;
        border: 1px solid #e9ecef;
        cursor: pointer;
        background: white;
        color: var(--dark);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .date-selector-container .btn:hover {
        background: #f8f9fa;
        border-color: var(--secondary);
        color: var(--secondary);
        transform: translateY(-1px);
    }

    /* Conteneur principal */
    .content-container {
        padding: 0 10px;
        margin: 0 auto;
        max-width: 1400px;
        width: 100%;
    }

    /* Statistiques des boutiques */
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
    }

    .stat-icon.active { background: linear-gradient(135deg, var(--success), #2ecc71); }
    .stat-icon.inactive { background: linear-gradient(135deg, var(--warning), #f1c40f); }
    .stat-icon.total { background: linear-gradient(135deg, var(--primary), #34495e); }
    .stat-icon.sales { background: linear-gradient(135deg, var(--accent), #16a085); }

    .stat-content {
        flex: 1;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--dark);
        line-height: 1;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 14px;
        color: var(--gray);
        font-weight: 500;
    }

    .stat-trend {
        display: flex;
        align-items: center;
        font-size: 13px;
        font-weight: 500;
        margin-top: 8px;
    }

    .stat-trend.positive { color: var(--success); }
    .stat-trend.negative { color: var(--danger); }

    /* Barre d'outils */
    .toolbar {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .search-box {
        flex: 1;
        min-width: 300px;
        position: relative;
    }

    .search-input {
        width: 100%;
        padding: 12px 45px 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .search-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
    }

    .filters {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .filter-select {
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        color: var(--dark);
        background: white;
        cursor: pointer;
        transition: all 0.3s;
    }

    .filter-select:focus {
        outline: none;
        border-color: var(--secondary);
    }

    .btn-add {
        background: linear-gradient(135deg, var(--success), #2ecc71);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-add:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
    }

    /* Tableau des boutiques */
    .table-container {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        margin-bottom: 30px;
        overflow: hidden;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .table-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .table-actions {
        display: flex;
        gap: 10px;
    }

    .btn-export, .btn-refresh {
        padding: 8px 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        background: white;
        color: var(--dark);
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-export:hover, .btn-refresh:hover {
        border-color: var(--secondary);
        color: var(--secondary);
    }

    .boutiques-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 14px;
    }

    .boutiques-table thead th {
        background: #f8f9fa;
        padding: 15px;
        font-weight: 600;
        color: var(--dark);
        border-bottom: 2px solid #e9ecef;
        text-align: left;
        position: sticky;
        top: 0;
    }

    .boutiques-table tbody td {
        padding: 15px;
        border-bottom: 1px solid #f1f1f1;
        transition: background 0.3s;
    }

    .boutiques-table tbody tr:hover td {
        background: #f8f9fa;
    }

    .boutiques-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* Badges de statut */
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .status-active {
        background: rgba(39, 174, 96, 0.1);
        color: var(--success);
    }

    .status-inactive {
        background: rgba(243, 156, 18, 0.1);
        color: var(--warning);
    }

    /* Actions */
    .actions {
        display: flex;
        gap: 8px;
    }

    .btn-action {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
    }

    .btn-edit {
        background: rgba(52, 152, 219, 0.1);
        color: var(--secondary);
    }

    .btn-edit:hover {
        background: var(--secondary);
        color: white;
        transform: translateY(-2px);
    }

    .btn-delete {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger);
    }

    .btn-delete:hover {
        background: var(--danger);
        color: white;
        transform: translateY(-2px);
    }

    .btn-view {
        background: rgba(26, 188, 156, 0.1);
        color: var(--accent);
    }

    .btn-view:hover {
        background: var(--accent);
        color: white;
        transform: translateY(-2px);
    }

    /* Performance indicator */
    .performance {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .performance-bar {
        width: 80px;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
    }

    .performance-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.6s ease;
    }

    .performance-high { background: var(--success); }
    .performance-medium { background: var(--warning); }
    .performance-low { background: var(--danger); }

    .performance-value {
        font-size: 13px;
        font-weight: 600;
        min-width: 40px;
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #f1f1f1;
    }

    .page-btn {
        width: 36px;
        height: 36px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        background: white;
        color: var(--dark);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .page-btn:hover {
        border-color: var(--secondary);
        color: var(--secondary);
    }

    .page-btn.active {
        background: var(--secondary);
        border-color: var(--secondary);
        color: white;
    }

    .page-info {
        font-size: 14px;
        color: var(--gray);
        margin: 0 10px;
    }

    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-state-icon {
        font-size: 60px;
        color: #e9ecef;
        margin-bottom: 20px;
    }

    .empty-state-title {
        font-size: 18px;
        color: var(--dark);
        margin-bottom: 10px;
    }

    .empty-state-message {
        color: var(--gray);
        font-size: 14px;
        margin-bottom: 25px;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .content-container {
            padding: 0 20px;
        }
    }

    @media (max-width: 992px) {
        .stats-cards {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .toolbar {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-box {
            min-width: 100%;
        }
        
        .filters {
            width: 100%;
            justify-content: space-between;
        }

        .date-selector-container {
            width: 100%;
            justify-content: space-between;
        }
    }

    @media (max-width: 768px) {
        .stats-cards {
            grid-template-columns: 1fr;
        }
        
        .boutiques-table {
            font-size: 13px;
        }
        
        .boutiques-table thead th,
        .boutiques-table tbody td {
            padding: 10px;
        }
        
        .table-header {
            flex-direction: column;
            align-items: stretch;
            gap: 15px;
        }
        
        .table-actions {
            justify-content: flex-end;
        }
        
        .actions {
            flex-wrap: wrap;
            justify-content: center;
        }

        .date-selector-container {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .date-selector-container .date-selector-label {
            margin-bottom: 5px;
        }

        .date-selector-container input,
        .date-selector-container button {
            width: 100%;
        }
    }

    @media (max-width: 576px) {
        .page-header {
            padding: 20px;
        }
        
        .page-header h1 {
            font-size: 24px;
        }
        
        .content-container {
            padding: 0 10px;
        }
        
        .filters {
            flex-direction: column;
        }
        
        .performance {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
    }

    /* Modal styles (pour future utilisation) */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }

    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .modal {
        background: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        transform: translateY(-20px);
        transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
        transform: translateY(0);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--dark);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--gray);
        cursor: pointer;
        padding: 5px;
        line-height: 1;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-container">
    <!-- Header de la page -->
    <div class="page-header">
        <h1><i class="fas fa-store me-3"></i>Gestion des Boutiques</h1>
        <p>Gérez l'ensemble de vos points de vente, visualisez leurs performances et leurs stocks</p>
        
        <div class="date-selector-container">
            <span class="date-selector-label">
                <i class="fas fa-calendar-alt me-2"></i>
                Date de consultation :
            </span>
            <input type="date" id="dashboardDate" class="date-selector" value="{{ current_date|default:'' }}">
            <button id="resetDate" class="btn btn-sm btn-light ms-2 reset-date-btn " style="padding: 8px 12px; border-radius: 6px; font-size: 13px; border: 1px solid #e9ecef; cursor: pointer;">
                <i class="fas fa-redo me-1"></i> Aujourd'hui
            </button>
        </div>
    </div>

    <!-- Statistiques des boutiques -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon total">
                <i class="fas fa-store"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ total_boutiques|default:"12" }}</div>
                <div class="stat-label">Total Boutiques</div>
                <div class="stat-trend positive">
                    <i class="fas fa-arrow-up me-1"></i>
                    <span>+2 cette année</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon active">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ active_boutiques|default:"10" }}</div>
                <div class="stat-label">Boutiques Actives</div>
                <div class="stat-trend positive">
                    <i class="fas fa-arrow-up me-1"></i>
                    <span>85% d'activité</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon inactive">
                <i class="fas fa-pause-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ inactive_boutiques|default:"2" }}</div>
                <div class="stat-label">Boutiques Inactives</div>
                <div class="stat-trend negative">
                    <i class="fas fa-arrow-down me-1"></i>
                    <span>Maintenance</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon sales">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ avg_sales|default:"1.2M" }} FCFA</div>
                <div class="stat-label">Ventes Moyennes</div>
                <div class="stat-trend positive">
                    <i class="fas fa-arrow-up me-1"></i>
                    <span>+12% ce mois</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Barre d'outils -->
    <div class="toolbar">
        <div class="search-box">
            <input type="text" class="search-input" placeholder="Rechercher une boutique..." id="searchInput">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <div class="filters">
            <select class="filter-select" id="statusFilter">
                <option value="all">Tous les statuts</option>
                <option value="active">Actives seulement</option>
                <option value="inactive">Inactives seulement</option>
            </select>
            
            <select class="filter-select" id="sortFilter">
                <option value="name">Trier par nom</option>
                <option value="sales">Trier par ventes</option>
                <option value="performance">Trier par performance</option>
                <option value="date">Trier par date</option>
            </select>
        </div>
        
        <button class="btn-add" id="addBoutiqueBtn">
            <i class="fas fa-plus-circle"></i>
            <span>Ajouter une Boutique</span>
        </button>
    </div>

    <!-- Tableau des boutiques -->
    <div class="table-container">
        <div class="table-header">
            <h3 class="table-title">
                <i class="fas fa-list"></i>
                Liste des Boutiques
                <span class="badge bg-primary ms-2">{{ total_boutiques|default:"12" }}</span>
            </h3>
            <div class="table-actions">
                <button class="btn-export" id="exportBtn">
                    <i class="fas fa-download"></i>
                    Exporter
                </button>
                <button class="btn-refresh" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i>
                    Actualiser
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="boutiques-table">
                <thead>
                    <tr>
                        <th style="width: 40px;">#</th>
                        <th>Nom</th>
                        <th>Responsable</th>
                        <th>Adresse</th>
                        <th>Téléphone</th>
                        <th>Statut</th>
                        <th>Performance</th>
                        <th>Ventes (mois)</th>
                        <th style="width: 120px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="boutiquesTableBody">
                    <!-- Les boutiques seront chargées dynamiquement -->
                </tbody>
            </table>
        </div>

        <!-- État vide -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">
                <i class="fas fa-store-slash"></i>
            </div>
            <h3 class="empty-state-title">Aucune boutique trouvée</h3>
            <p class="empty-state-message">
                Aucune boutique ne correspond à votre recherche. Essayez avec d'autres critères.
            </p>
            <button class="btn-add" id="resetSearchBtn">
                <i class="fas fa-redo me-2"></i>
                Réinitialiser la recherche
            </button>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <!-- La pagination sera générée dynamiquement -->
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Modal d'ajout/modification -->
<div class="modal-overlay" id="boutiqueModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Ajouter une Boutique</h3>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <form id="boutiqueForm">
            <div class="mb-3">
                <label class="form-label">Nom de la boutique</label>
                <input type="text" class="form-control" id="boutiqueName" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Responsable</label>
                <input type="text" class="form-control" id="boutiqueManager" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Adresse</label>
                <textarea class="form-control" id="boutiqueAddress" rows="3" required></textarea>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Téléphone</label>
                    <input type="tel" class="form-control" id="boutiquePhone" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="boutiqueEmail">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Heures d'ouverture</label>
                    <input type="text" class="form-control" id="boutiqueHours" placeholder="8h - 20h">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Statut</label>
                    <select class="form-control" id="boutiqueStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            <div class="d-flex justify-content-end gap-2 mt-4">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Annuler</button>
                <button type="submit" class="btn btn-primary" id="saveBtn">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Template pour les lignes du tableau -->
<template id="boutiqueRowTemplate">
    <tr class="boutique-row">
        <td class="text-center boutique-id"></td>
        <td>
            <strong class="boutique-name"></strong>
            <div class="text-muted small boutique-email"></div>
        </td>
        <td>
            <div class="boutique-manager"></div>
            <div class="text-muted small boutique-role"></div>
        </td>
        <td class="boutique-address"></td>
        <td class="boutique-phone"></td>
        <td>
            <span class="status-badge boutique-status"></span>
        </td>
        <td>
            <div class="performance">
                <div class="performance-bar">
                    <div class="performance-fill"></div>
                </div>
                <span class="performance-value"></span>
            </div>
        </td>
        <td class="boutique-sales fw-bold"></td>
        <td>
            <div class="actions">
                <button class="btn-action btn-view" title="Voir détails">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-action btn-edit" title="Modifier">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-action btn-delete" title="Supprimer">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>
</template>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Données de démonstration
    const boutiquesData = [
        {
            id: 1,
            name: "Boutique Centrale",
            manager: "Mamadou Diallo",
            role: "Gérant",
            address: "Marché Central, Rue 12",
            phone: "77 123 45 67",
            email: "centrale@poissonnerie.com",
            status: "active",
            performance: 85,
            sales: "2.4M FCFA",
            hours: "8h - 20h",
            opened: "2020-01-15"
        },
        {
            id: 2,
            name: "Boutique Sud",
            manager: "Aïssatou Ndiaye",
            role: "Responsable",
            address: "Zone Sud, Avenue Liberté",
            phone: "76 234 56 78",
            email: "sud@poissonnerie.com",
            status: "active",
            performance: 92,
            sales: "1.8M FCFA",
            hours: "7h30 - 19h30",
            opened: "2021-03-20"
        },
        {
            id: 3,
            name: "Boutique Nord",
            manager: "Ibrahima Sow",
            role: "Gérant",
            address: "Quartier Nord, Rue du Marché",
            phone: "70 345 67 89",
            email: "nord@poissonnerie.com",
            status: "active",
            performance: 78,
            sales: "1.5M FCFA",
            hours: "9h - 18h",
            opened: "2022-05-10"
        },
        {
            id: 4,
            name: "Boutique Ouest",
            manager: "Fatou Bâ",
            role: "Responsable",
            address: "Zone Ouest, Boulevard Maritime",
            phone: "78 456 78 90",
            email: "ouest@poissonnerie.com",
            status: "inactive",
            performance: 45,
            sales: "850K FCFA",
            hours: "8h - 17h",
            opened: "2023-02-15",
            notes: "En rénovation"
        },
        {
            id: 5,
            name: "Boutique Est",
            manager: "Abdoulaye Diop",
            role: "Gérant",
            address: "Quartier Est, Avenue de la Mer",
            phone: "77 567 89 01",
            email: "est@poissonnerie.com",
            status: "active",
            performance: 65,
            sales: "1.2M FCFA",
            hours: "8h - 19h",
            opened: "2021-11-30"
        },
        {
            id: 6,
            name: "Boutique Plateau",
            manager: "Mariama Sy",
            role: "Responsable",
            address: "Plateau, Rue du Commerce",
            phone: "76 678 90 12",
            email: "plateau@poissonnerie.com",
            status: "active",
            performance: 88,
            sales: "2.1M FCFA",
            hours: "7h - 21h",
            opened: "2020-08-22"
        },
        {
            id: 7,
            name: "Boutique Almadies",
            manager: "Cheikh Fall",
            role: "Gérant",
            address: "Almadies, Corniche Ouest",
            phone: "70 789 01 23",
            email: "almadies@poissonnerie.com",
            status: "active",
            performance: 95,
            sales: "3.2M FCFA",
            hours: "8h - 22h",
            opened: "2023-01-10"
        },
        {
            id: 8,
            name: "Boutique Mermoz",
            manager: "Aminata Diagne",
            role: "Responsable",
            address: "Mermoz, Avenue Cheikh Anta Diop",
            phone: "78 890 12 34",
            email: "mermoz@poissonnerie.com",
            status: "active",
            performance: 72,
            sales: "1.6M FCFA",
            hours: "8h - 20h",
            opened: "2022-07-15"
        }
    ];

    // Variables d'état
    let currentPage = 1;
    const itemsPerPage = 5;
    let filteredBoutiques = [...boutiquesData];
    let sortBy = 'name';
    let statusFilter = 'all';
    let searchTerm = '';

    // Éléments DOM
    const tableBody = document.getElementById('boutiquesTableBody');
    const emptyState = document.getElementById('emptyState');
    const pagination = document.getElementById('pagination');
    const searchInput = document.getElementById('searchInput');
    const statusFilterEl = document.getElementById('statusFilter');
    const sortFilter = document.getElementById('sortFilter');
    const addBoutiqueBtn = document.getElementById('addBoutiqueBtn');
    const exportBtn = document.getElementById('exportBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const resetSearchBtn = document.getElementById('resetSearchBtn');
    const boutiqueModal = document.getElementById('boutiqueModal');
    const modalClose = document.getElementById('modalClose');
    const cancelBtn = document.getElementById('cancelBtn');
    const boutiqueForm = document.getElementById('boutiqueForm');
    
    // Nouveaux éléments pour le sélecteur de date
    const dashboardDate = document.getElementById('dashboardDate');
    const resetDateBtn = document.getElementById('resetDate');

    // Initialisation
    function init() {
        // Initialiser la date
        initDateSelector();
        
        renderTable();
        setupEventListeners();
        updateStats();
    }

    // Initialiser le sélecteur de date
    function initDateSelector() {
        // Si la date est vide, mettre la date du jour
        if (!dashboardDate.value) {
            const today = new Date().toISOString().split('T')[0];
            dashboardDate.value = today;
        }
        
        // Mettre à jour les statistiques en fonction de la date sélectionnée
        updateDateBasedData();
    }

    // Mettre à jour les données basées sur la date
    function updateDateBasedData() {
        const selectedDate = dashboardDate.value;
        console.log('Date sélectionnée pour consultation:', selectedDate);
        
        // Ici, vous pourriez faire un appel API pour récupérer les données
        // correspondant à la date sélectionnée
        // Pour l'instant, nous allons juste afficher une notification
        showNotification(`Données mises à jour pour le ${selectedDate}`, 'info');
        
        // Mettre à jour les statistiques affichées
        updateStatsForDate(selectedDate);
    }

    // Mettre à jour les statistiques pour une date spécifique
    function updateStatsForDate(date) {
        // Simuler des données différentes selon la date
        // En production, vous feriez un appel API ici
        console.log('Mise à jour des statistiques pour la date:', date);
        
        // Exemple: ajuster les ventes moyennes selon la date
        const dateObj = new Date(date);
        const dayOfWeek = dateObj.getDay();
        
        // Les weekends ont généralement plus de ventes
        let salesMultiplier = 1.0;
        if (dayOfWeek === 0 || dayOfWeek === 6) { // Samedi ou dimanche
            salesMultiplier = 1.3;
        }
        
        // Mettre à jour l'affichage des statistiques si nécessaire
        // (Cette partie dépend de comment vous voulez afficher les stats)
    }

    // Mettre à jour les statistiques
    function updateStats() {
        const total = boutiquesData.length;
        const active = boutiquesData.filter(b => b.status === 'active').length;
        const inactive = total - active;
        
        // Calculer les ventes moyennes
        const totalSales = boutiquesData.reduce((sum, b) => {
            const sales = parseFloat(b.sales.replace(/[^0-9.]/g, ''));
            return sum + (isNaN(sales) ? 0 : sales);
        }, 0);
        
        const avgSales = (totalSales / total / 1000).toFixed(1) + 'M';
        
        // Mettre à jour l'affichage (si vous avez des éléments pour afficher ces stats)
        console.log('Statistiques mises à jour:', { total, active, inactive, avgSales });
    }

    // Filtrer et trier les boutiques
    function filterAndSortBoutiques() {
        let result = [...boutiquesData];
        
        // Filtrer par recherche
        if (searchTerm) {
            const term = searchTerm.toLowerCase();
            result = result.filter(b => 
                b.name.toLowerCase().includes(term) ||
                b.manager.toLowerCase().includes(term) ||
                b.address.toLowerCase().includes(term) ||
                b.phone.includes(term)
            );
        }
        
        // Filtrer par statut
        if (statusFilter !== 'all') {
            result = result.filter(b => b.status === statusFilter);
        }
        
        // Trier
        result.sort((a, b) => {
            switch(sortBy) {
                case 'name':
                    return a.name.localeCompare(b.name);
                case 'sales':
                    const salesA = parseFloat(a.sales.replace(/[^0-9.]/g, ''));
                    const salesB = parseFloat(b.sales.replace(/[^0-9.]/g, ''));
                    return salesB - salesA;
                case 'performance':
                    return b.performance - a.performance;
                case 'date':
                    return new Date(b.opened) - new Date(a.opened);
                default:
                    return 0;
            }
        });
        
        filteredBoutiques = result;
        return result;
    }

    // Rendre le tableau
    function renderTable() {
        const boutiques = filterAndSortBoutiques();
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageBoutiques = boutiques.slice(startIndex, endIndex);
        
        tableBody.innerHTML = '';
        
        if (pageBoutiques.length === 0) {
            emptyState.style.display = 'block';
            tableBody.style.display = 'none';
        } else {
            emptyState.style.display = 'none';
            tableBody.style.display = 'table-row-group';
            
            pageBoutiques.forEach((boutique, index) => {
                const template = document.getElementById('boutiqueRowTemplate');
                const clone = template.content.cloneNode(true);
                const row = clone.querySelector('.boutique-row');
                
                // Remplir les données
                clone.querySelector('.boutique-id').textContent = startIndex + index + 1;
                clone.querySelector('.boutique-name').textContent = boutique.name;
                clone.querySelector('.boutique-email').textContent = boutique.email;
                clone.querySelector('.boutique-manager').textContent = boutique.manager;
                clone.querySelector('.boutique-role').textContent = boutique.role;
                clone.querySelector('.boutique-address').textContent = boutique.address;
                clone.querySelector('.boutique-phone').textContent = boutique.phone;
                
                // Statut
                const statusElement = clone.querySelector('.boutique-status');
                if (boutique.status === 'active') {
                    statusElement.className = 'status-badge status-active';
                    statusElement.innerHTML = `<i class="fas fa-circle me-1"></i>Active`;
                } else {
                    statusElement.className = 'status-badge status-inactive';
                    statusElement.innerHTML = `<i class="fas fa-circle me-1"></i>Inactive`;
                }
                
                // Performance
                const performanceFill = clone.querySelector('.performance-fill');
                const performanceValue = clone.querySelector('.performance-value');
                performanceFill.style.width = `${boutique.performance}%`;
                
                if (boutique.performance >= 80) {
                    performanceFill.className = 'performance-fill performance-high';
                } else if (boutique.performance >= 60) {
                    performanceFill.className = 'performance-fill performance-medium';
                } else {
                    performanceFill.className = 'performance-fill performance-low';
                }
                
                performanceValue.textContent = `${boutique.performance}%`;
                
                // Ventes
                clone.querySelector('.boutique-sales').textContent = boutique.sales;
                
                // Actions
                const viewBtn = clone.querySelector('.btn-view');
                const editBtn = clone.querySelector('.btn-edit');
                const deleteBtn = clone.querySelector('.btn-delete');
                
                viewBtn.addEventListener('click', () => viewBoutique(boutique));
                editBtn.addEventListener('click', () => editBoutique(boutique));
                deleteBtn.addEventListener('click', () => deleteBoutique(boutique.id, boutique.name));
                
                tableBody.appendChild(clone);
            });
        }
        
        renderPagination(boutiques.length);
    }

    // Rendre la pagination
    function renderPagination(totalItems) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        pagination.innerHTML = '';
        
        if (totalPages <= 1) return;
        
        // Bouton précédent
        if (currentPage > 1) {
            const prevBtn = createPageButton('←', currentPage - 1);
            pagination.appendChild(prevBtn);
        }
        
        // Pages
        for (let i = 1; i <= totalPages; i++) {
            const pageBtn = createPageButton(i, i);
            if (i === currentPage) {
                pageBtn.classList.add('active');
            }
            pagination.appendChild(pageBtn);
        }
        
        // Bouton suivant
        if (currentPage < totalPages) {
            const nextBtn = createPageButton('→', currentPage + 1);
            pagination.appendChild(nextBtn);
        }
        
        // Info
        const info = document.createElement('span');
        info.className = 'page-info';
        info.textContent = `${totalItems} boutiques`;
        pagination.appendChild(info);
    }

    // Créer un bouton de page
    function createPageButton(text, page) {
        const btn = document.createElement('button');
        btn.className = 'page-btn';
        btn.textContent = text;
        btn.addEventListener('click', () => {
            currentPage = page;
            renderTable();
        });
        return btn;
    }

    // Configurer les événements
    function setupEventListeners() {
        // Recherche
        searchInput.addEventListener('input', function() {
            searchTerm = this.value;
            currentPage = 1;
            renderTable();
        });

        // Filtres
        statusFilterEl.addEventListener('change', function() {
            statusFilter = this.value;
            currentPage = 1;
            renderTable();
        });

        sortFilter.addEventListener('change', function() {
            sortBy = this.value;
            renderTable();
        });

        // Boutons
        addBoutiqueBtn.addEventListener('click', () => {
            openModal('add');
        });

        exportBtn.addEventListener('click', exportData);
        refreshBtn.addEventListener('click', refreshData);
        resetSearchBtn.addEventListener('click', resetSearch);

        // Gestion du sélecteur de date
        dashboardDate.addEventListener('change', function() {
            updateDateBasedData();
        });

        resetDateBtn.addEventListener('click', function() {
            const today = new Date().toISOString().split('T')[0];
            dashboardDate.value = today;
            updateDateBasedData();
            showNotification('Date réinitialisée à aujourd\'hui', 'info');
        });

        // Modal
        modalClose.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        
        boutiqueForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveBoutique();
        });

        // Fermer modal avec ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && boutiqueModal.classList.contains('active')) {
                closeModal();
            }
        });

        // Fermer modal en cliquant à l'extérieur
        boutiqueModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    }

    // Ouvrir modal
    function openModal(mode, boutique = null) {
        const modalTitle = document.getElementById('modalTitle');
        const form = document.getElementById('boutiqueForm');
        
        if (mode === 'add') {
            modalTitle.textContent = 'Ajouter une Boutique';
            form.reset();
        } else if (mode === 'edit' && boutique) {
            modalTitle.textContent = 'Modifier la Boutique';
            // Pré-remplir le formulaire
            document.getElementById('boutiqueName').value = boutique.name;
            document.getElementById('boutiqueManager').value = boutique.manager;
            document.getElementById('boutiqueAddress').value = boutique.address;
            document.getElementById('boutiquePhone').value = boutique.phone;
            document.getElementById('boutiqueEmail').value = boutique.email;
            document.getElementById('boutiqueHours').value = boutique.hours;
            document.getElementById('boutiqueStatus').value = boutique.status;
        }
        
        boutiqueModal.classList.add('active');
    }

    // Fermer modal
    function closeModal() {
        boutiqueModal.classList.remove('active');
        boutiqueForm.reset();
    }

    // Sauvegarder boutique
    function saveBoutique() {
        const name = document.getElementById('boutiqueName').value;
        const manager = document.getElementById('boutiqueManager').value;
        const address = document.getElementById('boutiqueAddress').value;
        const phone = document.getElementById('boutiquePhone').value;
        const email = document.getElementById('boutiqueEmail').value;
        const hours = document.getElementById('boutiqueHours').value;
        const status = document.getElementById('boutiqueStatus').value;
        
        // Ici, normalement, vous enverriez les données au serveur
        console.log('Boutique à sauvegarder:', {
            name, manager, address, phone, email, hours, status
        });
        
        showNotification('Boutique sauvegardée avec succès', 'success');
        closeModal();
        refreshData();
    }

    // Voir les détails d'une boutique
    function viewBoutique(boutique) {
        alert(`Détails de ${boutique.name}\n\n` +
              `Responsable: ${boutique.manager}\n` +
              `Adresse: ${boutique.address}\n` +
              `Téléphone: ${boutique.phone}\n` +
              `Email: ${boutique.email}\n` +
              `Heures: ${boutique.hours}\n` +
              `Performance: ${boutique.performance}%\n` +
              `Ventes mensuelles: ${boutique.sales}\n` +
              `Ouverte depuis: ${boutique.opened}`);
    }

    // Modifier une boutique
    function editBoutique(boutique) {
        openModal('edit', boutique);
    }

    // Supprimer une boutique
    function deleteBoutique(id, name) {
        if (confirm(`Êtes-vous sûr de vouloir supprimer la boutique "${name}" ?\nCette action est irréversible.`)) {
            // Ici, normalement, vous enverriez une requête de suppression au serveur
            console.log(`Suppression de la boutique #${id}: ${name}`);
            showNotification(`Boutique "${name}" supprimée`, 'success');
            refreshData();
        }
    }

    // Exporter les données
    function exportData() {
        const data = {
            exportDate: new Date().toISOString(),
            consultationDate: dashboardDate.value,
            total: filteredBoutiques.length,
            boutiques: filteredBoutiques
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `boutiques-${dashboardDate.value}-export.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('Export des données réussi', 'success');
    }

    // Actualiser les données
    function refreshData() {
        currentPage = 1;
        searchTerm = '';
        searchInput.value = '';
        statusFilter = 'all';
        statusFilterEl.value = 'all';
        sortBy = 'name';
        sortFilter.value = 'name';
        
        renderTable();
        updateStats();
        showNotification('Données actualisées', 'info');
    }

    // Réinitialiser la recherche
    function resetSearch() {
        searchTerm = '';
        searchInput.value = '';
        statusFilter = 'all';
        statusFilterEl.value = 'all';
        sortBy = 'name';
        sortFilter.value = 'name';
        currentPage = 1;
        
        renderTable();
    }

    // Afficher une notification
    function showNotification(message, type = 'info') {
        // Créer une notification simple
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Supprimer après 3 secondes
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Initialiser l'application
    init();
});
</script>
{% endblock %}