{% extends 'Base/base.html' %}

{% block title %}Dashboard - Vue d'ensemble{% endblock %}

{% block extra_css %}
<style>
    /* Variables supplémentaires */
    :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --accent: #1abc9c;
        --success: #27ae60;
        --warning: #f39c12;
        --danger: #e74c3c;
        --info: #9b59b6;
        --light: #f8f9fa;
        --dark: #2c3e50;
        --gray: #95a5a6;
    }

    /* Conteneur principal avec marges */
    .dashboard-content {
        padding: 0 15px;
        margin: 0 auto;
        max-width: 1400px;
        width: 100%;
    }

    /* Dashboard Header amélioré */
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary), #34495e);
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .dashboard-header h1 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .dashboard-header p {
        opacity: 0.9;
        margin-bottom: 20px;
    }

    .date-selector-container {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-top: 15px;
    }

    .date-selector-label {
        font-size: 14px;
        opacity: 0.9;
    }

    .date-selector {
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 200px;
    }

    .date-selector:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    .date-selector:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
    }

    /* Stats Cards compactes */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        border: 1px solid #f1f1f1;
        position: relative;
        overflow: hidden;
        height: 180px;
        display: flex;
        flex-direction: column;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
    }

    .stat-card.primary::before { background: var(--primary); }
    .stat-card.secondary::before { background: var(--secondary); }
    .stat-card.success::before { background: var(--success); }
    .stat-card.warning::before { background: var(--warning); }
    .stat-card.danger::before { background: var(--danger); }
    .stat-card.accent::before { background: var(--accent); }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        margin-bottom: 15px;
    }

    .stat-icon.primary { background: linear-gradient(135deg, var(--primary), #34495e); }
    .stat-icon.secondary { background: linear-gradient(135deg, var(--secondary), #2980b9); }
    .stat-icon.success { background: linear-gradient(135deg, var(--success), #2ecc71); }
    .stat-icon.warning { background: linear-gradient(135deg, var(--warning), #f1c40f); }
    .stat-icon.danger { background: linear-gradient(135deg, var(--danger), #c0392b); }
    .stat-icon.accent { background: linear-gradient(135deg, var(--accent), #16a085); }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--dark);
        line-height: 1;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 13px;
        color: var(--gray);
        font-weight: 500;
        margin-bottom: 8px;
    }

    .stat-change {
        display: flex;
        align-items: center;
        font-size: 12px;
        font-weight: 500;
        margin-top: auto;
    }

    .stat-change.positive { color: var(--success); }
    .stat-change.negative { color: var(--danger); }
    .stat-change.neutral { color: var(--gray); }

    /* Summary Cards compactes */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .summary-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        height: 100%;
    }

    .summary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 12px;
        border-bottom: 1px solid #f1f1f1;
    }

    .summary-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--dark);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .summary-count {
        font-size: 13px;
        color: var(--gray);
        background: rgba(149, 165, 166, 0.1);
        padding: 3px 8px;
        border-radius: 12px;
    }

    .summary-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #f8f9fa;
    }

    .summary-item:last-child {
        border-bottom: none;
    }

    .summary-item-content {
        display: flex;
        align-items: center;
        flex: 1;
    }

    .summary-item-icon {
        width: 30px;
        height: 30px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 13px;
        color: white;
    }

    .summary-item-text {
        flex: 1;
    }

    .summary-item-title {
        font-size: 13px;
        font-weight: 500;
        color: var(--dark);
        margin-bottom: 2px;
    }

    .summary-item-subtitle {
        font-size: 11px;
        color: var(--gray);
    }

    .summary-item-value {
        font-size: 13px;
        font-weight: 600;
        color: var(--dark);
    }

    /* Table Styles améliorés */
    .table-container {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        margin-bottom: 25px;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .table-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--dark);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .table-filters {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .date-filter {
        padding: 8px 12px;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        font-size: 13px;
        color: var(--dark);
        cursor: pointer;
        background: white;
        transition: all 0.3s;
    }

    .date-filter:hover {
        border-color: var(--secondary);
    }

    .data-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
    }

    .data-table thead th {
        background: #f8f9fa;
        padding: 12px;
        font-weight: 600;
        color: var(--dark);
        border-bottom: 2px solid #e9ecef;
        text-align: left;
        position: sticky;
        top: 0;
        font-size: 13px;
    }

    .data-table tbody td {
        padding: 12px;
        border-bottom: 1px solid #f1f1f1;
        transition: background 0.3s;
        font-size: 13px;
    }

    .data-table tbody tr:hover td {
        background: #f8f9fa;
    }

    .data-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* Quick Actions compactes */
    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
    }

    .quick-action-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f1f1;
        transition: all 0.3s ease;
        text-decoration: none;
        color: var(--dark);
        display: block;
        height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .quick-action-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        color: var(--dark);
    }

    .action-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 10px;
        font-size: 18px;
        color: white;
    }

    .action-icon.primary { background: linear-gradient(135deg, var(--primary), #34495e); }
    .action-icon.secondary { background: linear-gradient(135deg, var(--secondary), #2980b9); }
    .action-icon.success { background: linear-gradient(135deg, var(--success), #2ecc71); }
    .action-icon.warning { background: linear-gradient(135deg, var(--warning), #f1c40f); }
    .action-icon.danger { background: linear-gradient(135deg, var(--danger), #c0392b); }
    .action-icon.accent { background: linear-gradient(135deg, var(--accent), #16a085); }
    .action-icon.info { background: linear-gradient(135deg, var(--info), #8e44ad); }

    .action-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .action-desc {
        font-size: 11px;
        color: var(--gray);
    }

    /* Badges */
    .badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .badge-primary { background: rgba(44, 62, 80, 0.1); color: var(--primary); }
    .badge-secondary { background: rgba(52, 152, 219, 0.1); color: var(--secondary); }
    .badge-success { background: rgba(39, 174, 96, 0.1); color: var(--success); }
    .badge-warning { background: rgba(243, 156, 18, 0.1); color: var(--warning); }
    .badge-danger { background: rgba(231, 76, 60, 0.1); color: var(--danger); }
    .badge-accent { background: rgba(26, 188, 156, 0.1); color: var(--accent); }
    .badge-info { background: rgba(155, 89, 182, 0.1); color: var(--info); }

    /* Progress Bars */
    .progress {
        height: 4px;
        border-radius: 2px;
        background: #e9ecef;
        overflow: hidden;
        margin: 8px 0;
    }

    .progress-bar {
        height: 100%;
        border-radius: 2px;
        transition: width 0.6s ease;
    }

    .progress-bar.primary { background: var(--primary); }
    .progress-bar.secondary { background: var(--secondary); }
    .progress-bar.success { background: var(--success); }
    .progress-bar.warning { background: var(--warning); }
    .progress-bar.danger { background: var(--danger); }
    .progress-bar.accent { background: var(--accent); }

    /* Responsive */
    @media (max-width: 1200px) {
        .dashboard-content {
            padding: 0 20px;
        }
    }

    @media (max-width: 992px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .summary-grid {
            grid-template-columns: 1fr;
        }
        
        .quick-actions-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .table-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .table-filters {
            justify-content: space-between;
        }
        
        .dashboard-content {
            padding: 0 15px;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .quick-actions-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .data-table {
            font-size: 12px;
        }
        
        .data-table thead th,
        .data-table tbody td {
            padding: 8px;
        }
        
        .dashboard-header {
            padding: 20px;
        }
        
        .date-selector-container {
            flex-direction: column;
            align-items: stretch;
        }
        
        .date-selector {
            min-width: 100%;
        }
        
        .dashboard-content {
            padding: 0 10px;
        }
    }

    @media (max-width: 480px) {
        .quick-actions-grid {
            grid-template-columns: 1fr;
        }
        
        .table-filters {
            flex-direction: column;
            align-items: stretch;
        }
        
        .date-filter {
            width: 100%;
        }
        
        .dashboard-content {
            padding: 0 5px;
        }
    }

    /* Animation pour les nouvelles activités */
    .new-activity {
        animation: highlight 2s ease;
    }

    @keyframes highlight {
        0% { background-color: rgba(26, 188, 156, 0.1); }
        100% { background-color: transparent; }
    }

    /* Statut des activités */
    .status-badge {
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 500;
    }

    .status-completed { background: rgba(39, 174, 96, 0.1); color: var(--success); }
    .status-pending { background: rgba(243, 156, 18, 0.1); color: var(--warning); }
    .status-failed { background: rgba(231, 76, 60, 0.1); color: var(--danger); }
    .status-processing { background: rgba(52, 152, 219, 0.1); color: var(--secondary); }

    /* Espacement supplémentaire */
    .dashboard-section {
        margin-bottom: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-content">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>Tableau de Bord</h1>
        <p>Vue d'ensemble complète de votre gestion de stock de poissonnerie</p>
        
       <div class="date-selector-container">
            <span class="date-selector-label">
                <i class="fas fa-calendar-alt me-2"></i>
                Date de consultation :
            </span>
            <input type="date" id="dashboardDate" class="date-selector" value="{{ current_date|default:'' }}">
            <button id="resetDate" class="btn btn-sm btn-light ms-2 reset-date-btn " style="padding: 8px 12px; border-radius: 6px; font-size: 13px; border: 1px solid #e9ecef; cursor: pointer;">
                <i class="fas fa-redo me-1"></i> Aujourd'hui
            </button>
        </div>
    </div>

    <!-- Statistiques Principales -->
    <div class="stats-grid dashboard-section">
        <!-- Boutiques -->
        <div class="stat-card primary">
            <div class="stat-header">
                <div class="stat-icon primary">
                    <i class="fas fa-store"></i>
                </div>
                <span class="badge badge-primary">{{ boutique_stats.total|default:"12" }} boutiques</span>
            </div>
            <div class="stat-value">{{ boutique_stats.total|default:"12" }}</div>
            <div class="stat-label">Boutiques</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up me-1"></i>
                <span>{{ boutique_stats.change|default:"2" }} cette semaine</span>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar primary" style="width: 85%"></div>
            </div>
            <div class="mt-2 text-muted small">
                <span>{{ boutique_stats.active|default:"10" }} actives</span>
                <span class="ms-2">{{ boutique_stats.inactive|default:"2" }} inactives</span>
            </div>
        </div>

        <!-- Produits -->
        <div class="stat-card success">
            <div class="stat-header">
                <div class="stat-icon success">
                    <i class="fas fa-boxes"></i>
                </div>
                <span class="badge badge-success">{{ produit_stats.categories|default:"8" }} catégories</span>
            </div>
            <div class="stat-value">{{ produit_stats.total|default:"156" }}</div>
            <div class="stat-label">Produits en Stock</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up me-1"></i>
                <span>{{ produit_stats.change|default:"15" }} ce mois</span>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar success" style="width: 75%"></div>
            </div>
            <div class="mt-2 text-muted small">
                <span>Valeur: {{ produit_stats.value|default:"4.2M" }} FCFA</span>
                <span class="ms-2">Rotation: {{ produit_stats.rotation|default:"42" }} jours</span>
            </div>
        </div>

        <!-- Ventes -->
        <div class="stat-card accent">
            <div class="stat-header">
                <div class="stat-icon accent">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <span class="badge badge-accent">{{ vente_stats.today_count|default:"28" }} aujourd'hui</span>
            </div>
            <div class="stat-value">{{ vente_stats.today_amount|default:"1.85M" }} FCFA</div>
            <div class="stat-label">Ventes du Jour</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up me-1"></i>
                <span>{{ vente_stats.change|default:"12.5" }}% vs hier</span>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar accent" style="width: 65%"></div>
            </div>
            <div class="mt-2 text-muted small">
                <span>Panier moyen: {{ vente_stats.average|default:"66k" }} FCFA</span>
                <span class="ms-2">CA mensuel: {{ vente_stats.monthly|default:"12.4M" }} FCFA</span>
            </div>
        </div>

        <!-- Alertes Stock -->
        <div class="stat-card danger">
            <div class="stat-header">
                <div class="stat-icon danger">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <span class="badge badge-danger">{{ alerte_stats.critical|default:"3" }} critiques</span>
            </div>
            <div class="stat-value">{{ alerte_stats.total|default:"7" }}</div>
            <div class="stat-label">Alertes Stock</div>
            <div class="stat-change negative">
                <i class="fas fa-arrow-down me-1"></i>
                <span>{{ alerte_stats.change|default:"2" }} de plus qu'hier</span>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar danger" style="width: 35%"></div>
            </div>
            <div class="mt-2 text-muted small">
                <span>À réapprovisionner: {{ alerte_stats.to_reorder|default:"5" }}</span>
                <span class="ms-2">Rupture: {{ alerte_stats.out_of_stock|default:"2" }}</span>
            </div>
        </div>
    </div>

    <!-- Récapitulatif par Module -->
    <div class="summary-grid dashboard-section">
        <!-- Produits -->
        <div class="summary-card">
            <div class="summary-header">
                <h4 class="summary-title">
                    <i class="fas fa-boxes"></i>
                    Produits
                </h4>
                <span class="summary-count">{{ produit_stats.total|default:"156" }}</span>
            </div>
            <ul class="summary-list">
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--success), #2ecc71);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">En Stock</div>
                            <div class="summary-item-subtitle">Disponibles</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ produit_stats.in_stock|default:"142" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--warning), #f1c40f);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Stock Faible</div>
                            <div class="summary-item-subtitle">À réapprovisionner</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ produit_stats.low_stock|default:"7" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--danger), #c0392b);">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Rupture</div>
                            <div class="summary-item-subtitle">Épuisés</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ produit_stats.out_of_stock|default:"2" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--accent), #16a085);">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Top Vendu</div>
                            <div class="summary-item-subtitle">Saumon Frais</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ produit_stats.top_seller|default:"375k" }} FCFA</div>
                </li>
            </ul>
            <div class="text-center mt-3">
                <a href="{% url 'produits' %}" class="btn btn-outline-success btn-sm">
                    <i class="fas fa-external-link-alt me-2"></i>Gérer les produits
                </a>
            </div>
        </div>

        <!-- Ventes & Transferts -->
        <div class="summary-card">
            <div class="summary-header">
                <h4 class="summary-title">
                    <i class="fas fa-exchange-alt"></i>
                    Ventes & Transferts
                </h4>
                <span class="summary-count">{{ vente_stats.today_count|default:"28" }}</span>
            </div>
            <ul class="summary-list">
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--success), #2ecc71);">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Ventes Aujourd'hui</div>
                            <div class="summary-item-subtitle">Transactions du jour</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ vente_stats.today_count|default:"28" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--accent), #16a085);">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Transferts Ce Mois</div>
                            <div class="summary-item-subtitle">Entre boutiques</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ transfert_stats.monthly|default:"15" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--secondary), #2980b9);">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">CA Mensuel</div>
                            <div class="summary-item-subtitle">Chiffre d'affaires</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ vente_stats.monthly|default:"12.4M" }} FCFA</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--primary), #34495e);">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Marge Moyenne</div>
                            <div class="summary-item-subtitle">Profitabilité</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ vente_stats.margin|default:"45" }}%</div>
                </li>
            </ul>
            <div class="text-center mt-3">
                <a href="{% url 'ventes' %}" class="btn btn-outline-accent btn-sm">
                    <i class="fas fa-external-link-alt me-2"></i>Voir les ventes
                </a>
            </div>
        </div>

        <!-- Boutiques -->
        <div class="summary-card">
            <div class="summary-header">
                <h4 class="summary-title">
                    <i class="fas fa-store"></i>
                    Boutiques
                </h4>
                <span class="summary-count">{{ boutique_stats.total|default:"12" }}</span>
            </div>
            <ul class="summary-list">
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--success), #2ecc71);">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Actives</div>
                            <div class="summary-item-subtitle">En activité</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ boutique_stats.active|default:"10" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--warning), #f1c40f);">
                            <i class="fas fa-pause"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Inactives</div>
                            <div class="summary-item-subtitle">Temporairement fermées</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ boutique_stats.inactive|default:"2" }}</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--secondary), #2980b9);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Performance Moy.</div>
                            <div class="summary-item-subtitle">CA par boutique</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ boutique_stats.avg_performance|default:"1.03M" }} FCFA</div>
                </li>
                <li class="summary-item">
                    <div class="summary-item-content">
                        <div class="summary-item-icon" style="background: linear-gradient(135deg, var(--accent), #16a085);">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="summary-item-text">
                            <div class="summary-item-title">Meilleure</div>
                            <div class="summary-item-subtitle">Plus haut CA</div>
                        </div>
                    </div>
                    <div class="summary-item-value">{{ boutique_stats.top_performer|default:"1.8M" }} FCFA</div>
                </li>
            </ul>
            <div class="text-center mt-3">
                <a href="{% url 'boutiques' %}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-external-link-alt me-2"></i>Gérer les boutiques
                </a>
            </div>
        </div>
    </div>

    <!-- Actions Rapides -->
    <div class="quick-actions-grid dashboard-section">
        <a href="{% url 'ventes' %}" class="quick-action-card">
            <div class="action-icon accent">
                <i class="fas fa-cart-plus"></i>
            </div>
            <h4 class="action-title">Nouvelle Vente</h4>
            <p class="action-desc">Enregistrer une transaction</p>
        </a>

        <a href="{% url 'produits' %}" class="quick-action-card">
            <div class="action-icon success">
                <i class="fas fa-box-seam"></i>
            </div>
            <h4 class="action-title">Gérer Stock</h4>
            <p class="action-desc">Ajouter/modifier</p>
        </a>

        <a href="{% url 'cartons' %}" class="quick-action-card">
            <div class="action-icon warning">
                <i class="fas fa-archive"></i>
            </div>
            <h4 class="action-title">Gérer Cartons</h4>
            <p class="action-desc">Suivi livraisons</p>
        </a>

        <a href="{% url 'boutiques' %}" class="quick-action-card">
            <div class="action-icon primary">
                <i class="fas fa-store"></i>
            </div>
            <h4 class="action-title">Boutiques</h4>
            <p class="action-desc">Points de vente</p>
        </a>

        <a href="{% url 'transferts' %}" class="quick-action-card">
            <div class="action-icon secondary">
                <i class="fas fa-exchange-alt"></i>
            </div>
            <h4 class="action-title">Nouveau Transfert</h4>
            <p class="action-desc">Transférer stock</p>
        </a>

        <a href="{% url 'mouvements' %}" class="quick-action-card">
            <div class="action-icon info">
                <i class="fas fa-chart-line"></i>
            </div>
            <h4 class="action-title">Mouvements</h4>
            <p class="action-desc">Historique complet</p>
        </a>
    </div>

    <!-- Activités Récentes -->
    <div class="table-container dashboard-section">
        <div class="table-header">
            <h3 class="table-title">
                <i class="fas fa-history"></i>
                Activités Récentes
            </h3>
            <div class="table-filters">
                <input type="date" id="activityDate" class="date-filter" value="{{ current_date|default:'' }}">
                <select id="activityFilter" class="date-filter">
                    <option value="all">Toutes les activités</option>
                    <option value="vente">Ventes</option>
                    <option value="stock">Stock</option>
                    <option value="transfert">Transferts</option>
                    <option value="alerte">Alertes</option>
                </select>
                <a href="{% url 'mouvements' %}" class="btn btn-sm btn-outline-primary">
                    Voir tout <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
        </div>
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 100px;">Type</th>
                        <th>Description</th>
                        <th style="width: 150px;">Boutique</th>
                        <th style="width: 120px;">Montant</th>
                        <th style="width: 150px;">Date</th>
                        <th style="width: 100px;">Statut</th>
                    </tr>
                </thead>
                <tbody id="activitiesBody">
                    <!-- Les activités seront chargées dynamiquement -->
                </tbody>
            </table>
        </div>
        <div class="text-center mt-3">
            <button id="loadMoreActivities" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-plus-circle me-2"></i> Charger plus d'activités
            </button>
        </div>
    </div>
</div>

<!-- Template pour les activités -->
<template id="activityTemplate">
    <tr class="activity-row">
        <td>
            <span class="badge activity-type"></span>
        </td>
        <td>
            <strong class="activity-title"></strong>
            <div class="text-muted small activity-description"></div>
        </td>
        <td class="activity-store"></td>
        <td class="activity-amount fw-bold"></td>
        <td>
            <div class="activity-date"></div>
            <div class="text-muted small activity-time"></div>
        </td>
        <td>
            <span class="status-badge activity-status"></span>
        </td>
    </tr>
</template>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Éléments DOM
    const dashboardDate = document.getElementById('dashboardDate');
    const resetDateBtn = document.getElementById('resetDate');
    const activityDate = document.getElementById('activityDate');
    const activityFilter = document.getElementById('activityFilter');
    const activitiesBody = document.getElementById('activitiesBody');
    const loadMoreBtn = document.getElementById('loadMoreActivities');
    
    // Données de démonstration pour les activités
    const activitiesData = {
        '{% now "Y-m-d" %}': [
            {
                type: 'vente',
                title: 'Saumon fumé × 3, Crevettes × 2',
                description: 'Transaction #TRX-001',
                store: 'Boutique Principale',
                amount: '85,500 FCFA',
                date: 'Aujourd\'hui',
                time: '10:30',
                status: 'completed'
            },
            {
                type: 'stock',
                title: 'Truite ajoutée: +50kg',
                description: 'Réapprovisionnement',
                store: 'Entrepôt Central',
                amount: '750,000 FCFA',
                date: 'Aujourd\'hui',
                time: '09:15',
                status: 'completed'
            },
            {
                type: 'alerte',
                title: 'Thon rouge: 5kg restant',
                description: 'Seuil minimum: 10kg',
                store: 'Boutique Sud',
                amount: '-',
                date: 'Aujourd\'hui',
                time: '16:45',
                status: 'pending'
            },
            {
                type: 'transfert',
                title: 'Commande #4589 livrée',
                description: '15 cartons de poisson',
                store: 'Entrepôt → Boutique Nord',
                amount: '-',
                date: 'Aujourd\'hui',
                time: '14:20',
                status: 'completed'
            }
        ],
        '2023-12-14': [
            {
                type: 'vente',
                title: 'Thon × 10kg, Saumon × 8kg',
                description: 'Transaction #TRX-045',
                store: 'Boutique Principale',
                amount: '450,000 FCFA',
                date: '14/12/2023',
                time: '11:45',
                status: 'completed'
            },
            {
                type: 'stock',
                title: 'Crevettes: +30kg',
                description: 'Réapprovisionnement',
                store: 'Entrepôt Central',
                amount: '540,000 FCFA',
                date: '14/12/2023',
                time: '10:30',
                status: 'completed'
            }
        ],
        '2023-12-13': [
            {
                type: 'vente',
                title: 'Promotion weekend spécial',
                description: 'Transaction #TRX-102',
                store: 'Boutique Ouest',
                amount: '650,000 FCFA',
                date: '13/12/2023',
                time: '18:30',
                status: 'completed'
            },
            {
                type: 'transfert',
                title: 'Commande express fournisseur',
                description: 'Livraison urgente',
                store: 'Fournisseur → Entrepôt',
                amount: '1,200,000 FCFA',
                date: '13/12/2023',
                time: '12:15',
                status: 'completed'
            }
        ]
    };

    // Variables d'état
    let currentPage = 1;
    const activitiesPerPage = 5;

    // Initialiser les dates
    function initializeDates() {
        const today = new Date().toISOString().split('T')[0];
        
        if (!dashboardDate.value) {
            dashboardDate.value = today;
        }
        
        if (!activityDate.value) {
            activityDate.value = today;
        }
        
        // Définir la date maximale comme aujourd'hui
        dashboardDate.max = today;
        activityDate.max = today;
        
        // Formater la date pour l'affichage
        formatDateForDisplay(dashboardDate.value);
    }

    // Formater la date pour l'affichage
    function formatDateForDisplay(dateString) {
        const date = new Date(dateString);
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];
        
        if (dateString === todayString) {
            document.querySelector('.date-selector-label').innerHTML = 
                '<i class="fas fa-calendar-alt me-2"></i>Aujourd\'hui :';
        } else {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = date.toLocaleDateString('fr-FR', options);
            document.querySelector('.date-selector-label').innerHTML = 
                `<i class="fas fa-calendar-alt me-2"></i>${formattedDate} :`;
        }
    }

    // Obtenir le type d'activité avec badge
    function getActivityTypeBadge(type) {
        const types = {
            'vente': { class: 'badge-success', text: 'Vente', icon: 'fas fa-shopping-cart' },
            'stock': { class: 'badge-primary', text: 'Stock', icon: 'fas fa-boxes' },
            'transfert': { class: 'badge-info', text: 'Transfert', icon: 'fas fa-exchange-alt' },
            'alerte': { class: 'badge-warning', text: 'Alerte', icon: 'fas fa-exclamation-triangle' },
            'mouvement': { class: 'badge-secondary', text: 'Mouvement', icon: 'fas fa-chart-line' }
        };
        
        return types[type] || { class: 'badge-secondary', text: type, icon: 'fas fa-circle' };
    }

    // Obtenir le statut avec badge
    function getStatusBadge(status) {
        const statuses = {
            'completed': { class: 'status-completed', text: 'Terminé', icon: 'fas fa-check' },
            'pending': { class: 'status-pending', text: 'En attente', icon: 'fas fa-clock' },
            'failed': { class: 'status-failed', text: 'Échoué', icon: 'fas fa-times' },
            'processing': { class: 'status-processing', text: 'En cours', icon: 'fas fa-sync' }
        };
        
        return statuses[status] || { class: 'status-pending', text: status, icon: 'fas fa-circle' };
    }

    // Charger les activités
    function loadActivities(date = null, filter = 'all', reset = false) {
        if (reset) {
            currentPage = 1;
            activitiesBody.innerHTML = '';
        }
        
        const selectedDate = date || activityDate.value;
        const selectedFilter = filter || activityFilter.value;
        
        // Récupérer les activités pour la date sélectionnée
        let activities = activitiesData[selectedDate] || [];
        
        // Filtrer par type si nécessaire
        if (selectedFilter !== 'all') {
            activities = activities.filter(activity => activity.type === selectedFilter);
        }
        
        // Calculer la pagination
        const startIndex = 0;
        const endIndex = startIndex + (activitiesPerPage * currentPage);
        const activitiesToShow = activities.slice(0, endIndex);
        
        // Effacer le tableau si reset
        if (reset) {
            activitiesBody.innerHTML = '';
        }
        
        // Charger les activités
        activitiesToShow.forEach((activity, index) => {
            const template = document.getElementById('activityTemplate');
            const clone = template.content.cloneNode(true);
            const row = clone.querySelector('.activity-row');
            
            // Configurer le type d'activité
            const typeBadge = getActivityTypeBadge(activity.type);
            const typeElement = clone.querySelector('.activity-type');
            typeElement.className = `badge ${typeBadge.class}`;
            typeElement.innerHTML = `<i class="${typeBadge.icon} me-1"></i>${typeBadge.text}`;
            
            // Configurer le statut
            const statusBadge = getStatusBadge(activity.status);
            const statusElement = clone.querySelector('.activity-status');
            statusElement.className = `status-badge ${statusBadge.class}`;
            statusElement.innerHTML = `<i class="${statusBadge.icon} me-1"></i>${statusBadge.text}`;
            
            // Remplir les données
            clone.querySelector('.activity-title').textContent = activity.title;
            clone.querySelector('.activity-description').textContent = activity.description;
            clone.querySelector('.activity-store').textContent = activity.store;
            clone.querySelector('.activity-amount').textContent = activity.amount;
            clone.querySelector('.activity-date').textContent = activity.date;
            clone.querySelector('.activity-time').textContent = activity.time;
            
            // Ajouter l'animation pour les nouvelles activités
            if (index === 0 && reset) {
                row.classList.add('new-activity');
            }
            
            activitiesBody.appendChild(clone);
        });
        
        // Gérer le bouton "Charger plus"
        if (activitiesToShow.length >= activities.length) {
            loadMoreBtn.style.display = 'none';
        } else {
            loadMoreBtn.style.display = 'inline-flex';
        }
        
        // Mettre à jour le titre avec la date
        updateActivityTitle(selectedDate);
    }

    // Mettre à jour le titre des activités
    function updateActivityTitle(dateString) {
        const titleElement = document.querySelector('.table-title');
        if (titleElement) {
            const today = new Date().toISOString().split('T')[0];
            const selectedDate = new Date(dateString).toISOString().split('T')[0];
            
            if (selectedDate === today) {
                titleElement.innerHTML = '<i class="fas fa-history"></i> Activités Aujourd\'hui';
            } else {
                const date = new Date(dateString);
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = date.toLocaleDateString('fr-FR', options);
                titleElement.innerHTML = `<i class="fas fa-history"></i> Activités du ${formattedDate}`;
            }
        }
    }

    // Mettre à jour les statistiques en fonction de la date
    function updateStatistics(dateString) {
        // Simuler la mise à jour des statistiques
        const today = new Date().toISOString().split('T')[0];
        const selectedDate = new Date(dateString).toISOString().split('T')[0];
        
        if (selectedDate === today) {
            // Statistiques d'aujourd'hui
            document.querySelector('.stat-card.primary .stat-value').textContent = '12';
            document.querySelector('.stat-card.success .stat-value').textContent = '156';
            document.querySelector('.stat-card.accent .stat-value').textContent = '1.85M FCFA';
            document.querySelector('.stat-card.danger .stat-value').textContent = '7';
        } else {
            // Statistiques d'une autre date (exemple)
            document.querySelector('.stat-card.primary .stat-value').textContent = '11';
            document.querySelector('.stat-card.success .stat-value').textContent = '148';
            document.querySelector('.stat-card.accent .stat-value').textContent = '1.65M FCFA';
            document.querySelector('.stat-card.danger .stat-value').textContent = '5';
        }
        
        // Mettre à jour l'affichage de la date
        formatDateForDisplay(dateString);
        
        // Afficher un message
        showNotification(`Données chargées pour le ${formatDateFrench(dateString)}`, 'info');
    }

    // Formater la date en français
    function formatDateFrench(dateString) {
        const date = new Date(dateString);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('fr-FR', options);
    }

    // Afficher une notification
    function showNotification(message, type = 'info') {
        // Créer une notification simple
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Supprimer après 3 secondes
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Événements
    dashboardDate.addEventListener('change', function() {
        updateStatistics(this.value);
    });

    resetDateBtn.addEventListener('click', function() {
        const today = new Date().toISOString().split('T')[0];
        dashboardDate.value = today;
        activityDate.value = today;
        updateStatistics(today);
        loadActivities(today, activityFilter.value, true);
        showNotification('Retour aux données d\'aujourd\'hui', 'success');
    });

    activityDate.addEventListener('change', function() {
        loadActivities(this.value, activityFilter.value, true);
    });

    activityFilter.addEventListener('change', function() {
        loadActivities(activityDate.value, this.value, true);
    });

    loadMoreBtn.addEventListener('click', function() {
        currentPage++;
        loadActivities(activityDate.value, activityFilter.value, false);
    });

    // Initialisation
    initializeDates();
    loadActivities(activityDate.value, activityFilter.value, true);
    updateStatistics(dashboardDate.value);

    // Animation pour les cartes de statistiques
    document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // Exporter les données du dashboard
    window.exportDashboardData = function() {
        const data = {
            exportDate: new Date().toISOString(),
            selectedDate: dashboardDate.value,
            statistics: {
                boutiques: document.querySelector('.stat-card.primary .stat-value').textContent,
                produits: document.querySelector('.stat-card.success .stat-value').textContent,
                ventes: document.querySelector('.stat-card.accent .stat-value').textContent,
                alertes: document.querySelector('.stat-card.danger .stat-value').textContent
            }
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `dashboard-export-${dashboardDate.value}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('Export des données réussi', 'success');
    };
});
</script>
{% endblock %}